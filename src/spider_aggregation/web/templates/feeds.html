{% extends "base.html" %}

{% block title %}è®¢é˜…æº - Spider Aggregation{% endblock %}

{% block content %}
<div class="page-header">
    <h2>è®¢é˜…æºç®¡ç†</h2>
    <button type="button" class="btn btn-primary" onclick="showAddFeedModal()">+ æ·»åŠ è®¢é˜…æº</button>
</div>

<div class="feeds-list">
    {% for feed in feeds %}
    <div class="feed-card" data-feed-id="{{ feed.id }}">
        <div class="feed-header">
            <h3 class="feed-name">
                <a href="{{ feed.url }}" target="_blank" rel="noopener">{{ feed.name or feed.url }}</a>
            </h3>
            <div style="display: flex; align-items: center; gap: 0.75rem;">
                <span class="feed-status {% if feed.enabled %}enabled{% else %}disabled{% endif %}">
                    {{ "å·²å¯ç”¨" if feed.enabled else "å·²ç¦ç”¨" }}
                </span>
                <div class="btn-group">
                    <button type="button" class="btn-icon" onclick="showEditFeedModal({{ feed.id }})" title="ç¼–è¾‘">âœï¸</button>
                    <button type="button" class="btn-icon" onclick="toggleFeed({{ feed.id }})" title="{{ 'ç¦ç”¨' if feed.enabled else 'å¯ç”¨' }}">
                        {{ 'â¸ï¸' if feed.enabled else 'â–¶ï¸' }}
                    </button>
                    <button type="button" class="btn-icon" onclick="fetchFeed({{ feed.id }})" title="ç«‹å³æŠ“å–">ğŸ”„</button>
                    <button type="button" class="btn-icon" onclick="deleteFeed({{ feed.id }})" title="åˆ é™¤">ğŸ—‘ï¸</button>
                </div>
            </div>
        </div>
        {% if feed.description %}
        <p class="feed-description">{{ feed.description }}</p>
        {% endif %}
        <div class="feed-meta">
            <span class="feed-url" title="{{ feed.url }}">{{ feed.url[:60] }}{% if feed.url|length > 60 %}...{% endif %}</span>
            <span>é—´éš”: {{ feed.fetch_interval_minutes }} åˆ†é’Ÿ</span>
            {% if feed.last_fetched_at %}
            <span>æœ€åæŠ“å–: {{ feed.last_fetched_at|format_datetime }}</span>
            {% endif %}
            {% if feed.fetch_error_count > 0 %}
            <span class="badge badge-{{ 'error' if feed.fetch_error_count > 5 else 'warning' }}">
                {{ feed.fetch_error_count }} ä¸ªé”™è¯¯
            </span>
            {% endif %}
        </div>
        {% if feed.last_error %}
        <div class="feed-error">
            <span class="error-text">{{ feed.last_error }}</span>
        </div>
        {% endif %}
    </div>
    {% else %}
    <div class="empty-state">
        <p>æš‚æ— è®¢é˜…æº</p>
        <p><button type="button" class="btn btn-primary" onclick="showAddFeedModal()">+ æ·»åŠ ç¬¬ä¸€ä¸ªè®¢é˜…æº</button></p>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/forms.js') }}"></script>
<script>
    // Store feed data for editing
    window.feedData = {{ feeds|tojson|safe }};
</script>
{% endblock %}

{% extends "base.html" %}

{% block title %}åˆ†ç±» - MindWeaver{% endblock %}

{% block content %}
<div class="page-header">
    <h2>åˆ†ç±»ç®¡ç†</h2>
    <button type="button" class="btn btn-primary" onclick="showAddCategoryModal()">+ æ·»åŠ åˆ†ç±»</button>
</div>

<!-- Stats Summary -->
<div class="dashboard-cards" style="margin-bottom: 2rem;">
    <div class="dashboard-card">
        <div class="dashboard-card-title">æ€»åˆ†ç±»æ•°</div>
        <div class="dashboard-card-value" id="total-categories">-</div>
    </div>
    <div class="dashboard-card">
        <div class="dashboard-card-title">å·²å¯ç”¨</div>
        <div class="dashboard-card-value" id="enabled-categories">-</div>
    </div>
    <div class="dashboard-card">
        <div class="dashboard-card-title">è®¢é˜…æºæ€»æ•°</div>
        <div class="dashboard-card-value" id="total-feeds-in-categories">-</div>
    </div>
</div>

<!-- Categories List -->
<div class="categories-list" id="categories-list">
    {% for category in categories %}
    <div class="category-card" data-category-id="{{ category.id }}" data-category-enabled="{{ category.enabled }}">
        <div class="category-header">
            <div class="category-title-row">
                <div class="category-icon" {% if category.color %}style="background-color: {{ category.color }}"{% endif %}>
                    {{ category.icon or 'ğŸ“' }}
                </div>
                <h3 class="category-name">{{ category.name }}</h3>
                <span class="category-status {% if category.enabled %}enabled{% else %}disabled{% endif %}">
                    {{ "å·²å¯ç”¨" if category.enabled else "å·²ç¦ç”¨" }}
                </span>
            </div>
            <div class="btn-group">
                <button type="button" class="btn-icon" onclick="showEditCategoryModal({{ category.id }})" title="ç¼–è¾‘">âœï¸</button>
                <button type="button" class="btn-icon" onclick="toggleCategory({{ category.id }})" title="{{ 'ç¦ç”¨' if category.enabled else 'å¯ç”¨' }}">
                    {{ 'â¸ï¸' if category.enabled else 'â–¶ï¸' }}
                </button>
                <button type="button" class="btn-icon" onclick="showCategoryFeeds({{ category.id }})" title="æŸ¥çœ‹è®¢é˜…æº">ğŸ“Š</button>
                <button type="button" class="btn-icon" onclick="deleteCategory({{ category.id }})" title="åˆ é™¤">ğŸ—‘ï¸</button>
            </div>
        </div>
        {% if category.description %}
        <p class="category-description">{{ category.description }}</p>
        {% endif %}
        <div class="category-meta">
            <span class="category-feed-count">
                <strong>{{ category.feed_count }}</strong> ä¸ªè®¢é˜…æº
            </span>
            {% if category.created_at %}
            <span>åˆ›å»ºäº {{ category.created_at|format_datetime }}</span>
            {% endif %}
        </div>
    </div>
    {% else %}
    <div class="empty-state">
        <p>æš‚æ— åˆ†ç±»</p>
        <p><button type="button" class="btn btn-primary" onclick="showAddCategoryModal()">+ æ·»åŠ ç¬¬ä¸€ä¸ªåˆ†ç±»</button></p>
    </div>
    {% endfor %}
</div>

<!-- Category Feeds Modal (hidden by default) -->
<div id="category-feeds-modal" class="modal-overlay" style="display: none;">
    <div class="modal-dialog" style="max-width: 700px;">
        <div class="modal-header">
            <h3 id="category-feeds-title">åˆ†ç±»è®¢é˜…æº</h3>
            <button type="button" class="modal-close" onclick="hideCategoryFeedsModal()">&times;</button>
        </div>
        <div class="modal-body" id="category-feeds-body">
            <!-- Content loaded dynamically -->
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/forms.js') }}"></script>
<script>
    // Store category data for editing
    window.categoryData = {{ categories|tojson|safe }};

    // Initialize stats
    document.addEventListener('DOMContentLoaded', function() {
        updateCategoryStats();
    });

    function updateCategoryStats() {
        const categories = window.categoryData || [];
        const total = categories.length;
        const enabled = categories.filter(c => c.enabled).length;
        const totalFeeds = categories.reduce((sum, c) => sum + (c.feed_count || 0), 0);

        document.getElementById('total-categories').textContent = total;
        document.getElementById('enabled-categories').textContent = enabled;
        document.getElementById('total-feeds-in-categories').textContent = totalFeeds;
    }
</script>
<script src="{{ url_for('static', filename='js/categories.js') }}"></script>
{% endblock %}

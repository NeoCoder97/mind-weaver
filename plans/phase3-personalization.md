# é˜¶æ®µ 3 - ä¸ªæ€§åŒ–ä¸æ™ºèƒ½æ¨è

## é˜¶æ®µç›®æ ‡

å¼•å…¥ç”¨æˆ·è¡Œä¸ºåˆ†æå’Œæœºå™¨å­¦ä¹ æ¨èç³»ç»Ÿï¼Œå®ç°åŸºäºç”¨æˆ·å…´è¶£çš„ä¸ªæ€§åŒ–å†…å®¹æ¨èã€‚

---

## æ ¸å¿ƒåŠŸèƒ½

### 1. ç”¨æˆ·è¡Œä¸ºè¿½è¸ª
- é˜…è¯»è¡Œä¸ºè®°å½•ï¼ˆç‚¹å‡»ã€å±•å¼€ã€åœç•™æ—¶é—´ï¼‰
- äº¤äº’è¡Œä¸ºï¼ˆæ ‡è®°ã€æ”¶è—ã€åˆ†äº«ï¼‰
- åé¦ˆæ”¶é›†ï¼ˆå–œæ¬¢/ä¸å–œæ¬¢ï¼‰

### 2. å…´è¶£æ¨¡å‹æ„å»º
- åŸºäºå…³é”®è¯çš„å…´è¶£ç”»åƒ
- ä¸»é¢˜åå¥½å‘é‡
- æ—¶é—´åå¥½æ¨¡å¼

### 3. æ™ºèƒ½æ¨èå¼•æ“
- åŸºäºå†…å®¹çš„æ¨èï¼ˆCBRï¼‰
- ååŒè¿‡æ»¤ï¼ˆCFï¼‰
- æ··åˆæ¨èç­–ç•¥
- å®æ—¶æ¨èæ›´æ–°

### 4. ä¸ªæ€§åŒ–ä½“éªŒ
- è‡ªå®šä¹‰ä¿¡æ¯æµæ’åº
- æ¨èç†ç”±è§£é‡Š
- å…´è¶£æ¢ç´¢å»ºè®®

---

## æŠ€æœ¯é€‰å‹

| åŠŸèƒ½ | æŠ€æœ¯æ–¹æ¡ˆ |
|------|----------|
| è¡Œä¸ºè¿½è¸ª | å‰ç«¯äº‹ä»¶ + åç«¯ API |
| å‘é‡åŒ– | TF-IDF / Sentence-BERT |
| ç›¸ä¼¼åº¦è®¡ç®— | scikit-learn / faiss |
| æ¨èç®—æ³• | LightFM / è‡ªå®šä¹‰å®ç° |
| ç‰¹å¾å­˜å‚¨ | SQLite JSON / PostgreSQL |
| ç¼“å­˜ | Redis / å†…å­˜ç¼“å­˜ |

---

## ä»»åŠ¡æ‹†è§£

### PHASE 3.1: ç”¨æˆ·è¡Œä¸ºæ•°æ®æ¨¡å‹ (3-4h)

| ID | ä»»åŠ¡ | éªŒæ”¶æ ‡å‡† |
|----|------|----------|
| 3.1.1 | è®¾è®¡ç”¨æˆ·è¡Œä¸ºæ¨¡å‹ | Event ç±»å‹è®¾è®¡ |
| 3.1.2 | å®ç°è¡Œä¸ºè®°å½• API | å‰ç«¯å¯è°ƒç”¨ |
| 3.1.3 | å®ç°è¡Œä¸ºç»Ÿè®¡èšåˆ | æŒ‰æ—¶é—´/ç±»å‹èšåˆ |
| 3.1.4 | æ·»åŠ æ•°æ®æ¸…æ´—é€»è¾‘ | å»é™¤å¼‚å¸¸è¡Œä¸º |
| 3.1.5 | ç¼–å†™è¡Œä¸ºè¿½è¸ªæµ‹è¯• | éªŒè¯æ•°æ®å‡†ç¡®æ€§ |

**æ•°æ®æ¨¡å‹ï¼š**
```python
class UserBehavior:
    - id, user_id, session_id
    - event_type: view | click | expand | bookmark | like | dismiss
    - entity_type: feed | entry
    - entity_id: Integer
    - metadata: JSON         # é¢å¤–ä¿¡æ¯ï¼ˆåœç•™æ—¶é—´ç­‰ï¼‰
    - timestamp

class UserProfile:
    - id, user_id
    - interests: JSON        # å…´è¶£å‘é‡
    - preferred_tags: JSON   # åå¥½æ ‡ç­¾
    - reading_time_stats: JSON
    - feedback_summary: JSON
    - updated_at
```

### PHASE 3.2: ç‰¹å¾å·¥ç¨‹ (4-5h)

| ID | ä»»åŠ¡ | éªŒæ”¶æ ‡å‡† |
|----|------|----------|
| 3.2.1 | å®ç°æ–‡æœ¬å‘é‡åŒ– | TF-IDF / Embedding |
| 3.2.2 | æ„å»ºç”¨æˆ·å…´è¶£å‘é‡ | åŸºäºå†å²è¡Œä¸º |
| 3.2.3 | æå–æ—¶é—´ç‰¹å¾ | é˜…è¯»æ—¶æ®µã€é¢‘ç‡ |
| 3.2.4 | æå–æ¥æºåå¥½ | ç½‘ç«™/ä½œè€…åå¥½ |
| 3.2.5 | ç‰¹å¾ç¼“å­˜ä¼˜åŒ– | å‡å°‘é‡å¤è®¡ç®— |
| 3.2.6 | ç‰¹å¾é‡è¦æ€§åˆ†æ | å¯è§£é‡Šæ€§ |

**ç‰¹å¾è®¾è®¡ï¼š**
```python
# å†…å®¹ç‰¹å¾
- content_vector: Array      # æ–‡æœ¬å‘é‡ (TF-IDF/Sentence-BERT)
- keyword_features: Dict     # å…³é”®è¯æƒé‡
- tag_features: Dict         # æ ‡ç­¾æƒé‡
- source_features: Dict      # æ¥æºæƒé‡

# ç”¨æˆ·ç‰¹å¾
- interest_vector: Array     # å…´è¶£å‘é‡
- reading_pattern: Dict      # é˜…è¯»æ—¶é—´æ¨¡å¼
- interaction_history: Dict  # äº¤äº’ç»Ÿè®¡
```

### PHASE 3.3: æ¨èç®—æ³•å®ç° (6-8h)

| ID | ä»»åŠ¡ | éªŒæ”¶æ ‡å‡† |
|----|------|----------|
| 3.3.1 | å®ç°åŸºäºå†…å®¹çš„æ¨è | ç›¸ä¼¼åº¦è®¡ç®— |
| 3.3.2 | å®ç°ååŒè¿‡æ»¤ | ç”¨æˆ·-æ¡ç›®çŸ©é˜µ |
| 3.3.3 | å®ç°æ··åˆæ¨èç­–ç•¥ | åŠ æƒèåˆ |
| 3.3.4 | æ·»åŠ å†·å¯åŠ¨å¤„ç† | æ–°ç”¨æˆ·æ¨è |
| 3.3.5 | å®ç°å¤šæ ·æ€§æ§åˆ¶ | é¿å…ä¿¡æ¯èŒ§æˆ¿ |
| 3.3.6 | A/B æµ‹è¯•æ¡†æ¶ | ç®—æ³•å¯¹æ¯” |

**æ¨èç®—æ³•ï¼š**
```python
class ContentBasedRecommender:
    # åŸºäºå†…å®¹ç›¸ä¼¼åº¦
    - compute_similarity(entry, user_profile)
    - recommend(user, n=10)

class CollaborativeFilteringRecommender:
    # ååŒè¿‡æ»¤
    - build_user_item_matrix()
    - compute_user_similarity()
    - recommend(user, n=10)

class HybridRecommender:
    # æ··åˆæ¨è
    - combine_scores(cb_score, cf_score, weights)
    - recommend(user, n=10)
```

### PHASE 3.4: æ¨èæœåŠ¡ API (3-4h)

| ID | ä»»åŠ¡ | éªŒæ”¶æ ‡å‡† |
|----|------|----------|
| 3.4.1 | è®¾è®¡æ¨è API | é€šç”¨æ¥å£ |
| 3.4.2 | å®ç°ä¸ªæ€§åŒ–ä¿¡æ¯æµ | æ’åº+åˆ†é¡µ |
| 3.4.3 | å®ç°æ¨èç†ç”±ç”Ÿæˆ | å¯è§£é‡Šæ€§ |
| 3.4.4 | æ·»åŠ æ¨èç¼“å­˜ | æå‡æ€§èƒ½ |
| 3.4.5 | API æ€§èƒ½ä¼˜åŒ– | å“åº”æ—¶é—´ < 500ms |

**API ç«¯ç‚¹ï¼š**
```
GET  /api/recommendations/feed     # ä¸ªæ€§åŒ–ä¿¡æ¯æµ
GET  /api/recommendations/discover # æ¢ç´¢æ¨è
GET  /api/recommendations/similar  # ç›¸ä¼¼å†…å®¹
POST /api/behavior/track           # è¡Œä¸ºè¿½è¸ª
GET  /api/profile/me               # ç”¨æˆ·ç”»åƒ
```

### PHASE 3.5: å‰ç«¯äº¤äº’å¢å¼º (4-5h)

| ID | ä»»åŠ¡ | éªŒæ”¶æ ‡å‡† |
|----|------|----------|
| 3.5.1 | å®ç°è¡Œä¸ºè¿½è¸ª SDK | è‡ªåŠ¨æ”¶é›†äº‹ä»¶ |
| 3.5.2 | è®¾è®¡æ¨èä¿¡æ¯æµ UI | ä¸æ™®é€šæµåŒºåˆ† |
| 3.5.3 | æ·»åŠ åé¦ˆäº¤äº’ | å¿«æ·ç‚¹èµ/ä¸æ„Ÿå…´è¶£ |
| 3.5.4 | å®ç°å…´è¶£ç®¡ç†ç•Œé¢ | æŸ¥çœ‹å’Œç¼–è¾‘ç”»åƒ |
| 3.5.5 | æ¨èè§£é‡Šå±•ç¤º | ä¸ºä»€ä¹ˆæ¨è |

### PHASE 3.6: åé¦ˆå­¦ä¹ ç³»ç»Ÿ (3-4h)

| ID | ä»»åŠ¡ | éªŒæ”¶æ ‡å‡† |
|----|------|----------|
| 3.6.1 | å®ç°åé¦ˆæ”¶é›† | æ˜¾å¼+éšå¼åé¦ˆ |
| 3.6.2 | åœ¨çº¿å­¦ä¹ æ›´æ–° | å¢é‡æ›´æ–°æ¨¡å‹ |
| 3.6.3 | æ¢ç´¢-åˆ©ç”¨å¹³è¡¡ | Îµ-greedy / Thompson sampling |
| 3.6.4 | æ¨èæ•ˆæœè¯„ä¼° | CTRã€åœç•™æ—¶é—´ |

### PHASE 3.7: å®éªŒä¸è¯„ä¼° (4-5h)

| ID | ä»»åŠ¡ | éªŒæ”¶æ ‡å‡† |
|----|------|----------|
| 3.7.1 | è®¾è®¡è¯„ä¼°æŒ‡æ ‡ | Precision@K, Recall@K, NDCG |
| 3.7.2 | å®ç°ç¦»çº¿è¯„ä¼° | å†å²æ•°æ®å›æµ‹ |
| 3.7.3 | A/B æµ‹è¯•æ¡†æ¶ | åœ¨çº¿å®éªŒ |
| 3.7.4 | æ¨èè´¨é‡åˆ†æ | å¤šç»´åº¦æŠ¥å‘Š |
| 3.7.5 | ç®—æ³•è°ƒä¼˜ | å‚æ•°æœç´¢ |

### PHASE 3.8: ç›‘æ§ä¸ä¼˜åŒ– (2-3h)

| ID | ä»»åŠ¡ | éªŒæ”¶æ ‡å‡† |
|----|------|----------|
| 3.8.1 | æ¨èæ€§èƒ½ç›‘æ§ | å»¶è¿Ÿã€å‘½ä¸­ç‡ |
| 3.8.2 | æ¨¡å‹è¡°å‡æ£€æµ‹ | å®šæœŸé‡è®­ç»ƒ |
| 3.8.3 | å†·å¯åŠ¨ä¼˜åŒ– | æ–°ç”¨æˆ·ç­–ç•¥ |
| 3.8.4 | ç¼“å­˜ç­–ç•¥ä¼˜åŒ– | TTLã€LRU |

### PHASE 3.9: æ–‡æ¡£ (2-3h)

| ID | ä»»åŠ¡ | éªŒæ”¶æ ‡å‡† |
|----|------|----------|
| 3.9.1 | ç®—æ³•æ–‡æ¡£ | æ¨èåŸç†è¯´æ˜ |
| 3.9.2 | API ä½¿ç”¨æŒ‡å— | é›†æˆè¯´æ˜ |
| 3.9.3 | è¯„ä¼°æŠ¥å‘Š | æ•ˆæœåˆ†æ |

---

## éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½æ€§
- âœ… å‡†ç¡®è®°å½•ç”¨æˆ·è¡Œä¸º
- âœ… æ¨èç›¸å…³æ€§ â‰¥ 60% (ç”¨æˆ·è°ƒç ”)
- âœ… æ”¯æŒå®æ—¶æ¨èæ›´æ–°
- âœ… å†·å¯åŠ¨ç”¨æˆ·å¯è·å–æ¨è

### æ€§èƒ½
- âœ… æ¨èå“åº”æ—¶é—´ â‰¤ 500ms
- âœ… æ”¯æŒè‡³å°‘ 1000 ç”¨æˆ·å¹¶å‘
- âœ… ç‰¹å¾æ›´æ–°å»¶è¿Ÿ â‰¤ 5 åˆ†é’Ÿ

### æ•ˆæœ
- âœ… CTR æå‡ â‰¥ 20%
- âœ… ç”¨æˆ·åœç•™æ—¶é—´å¢åŠ  â‰¥ 15%
- âœ… æ¨èå¤šæ ·æ€§æŒ‡æ•° â‰¥ 0.4

### ä»£ç è´¨é‡
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 70%
- âœ… æ¨èç®—æ³•å¯é…ç½®
- âœ… A/B æµ‹è¯•æ¡†æ¶å¯ç”¨

---

## æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | é¢„è®¡æ—¶é—´ |
|------|----------|
| 3.1 è¡Œä¸ºæ•°æ®æ¨¡å‹ | 3-4h |
| 3.2 ç‰¹å¾å·¥ç¨‹ | 4-5h |
| 3.3 æ¨èç®—æ³• | 6-8h |
| 3.4 æ¨èæœåŠ¡ API | 3-4h |
| 3.5 å‰ç«¯äº¤äº’ | 4-5h |
| 3.6 åé¦ˆå­¦ä¹  | 3-4h |
| 3.7 å®éªŒè¯„ä¼° | 4-5h |
| 3.8 ç›‘æ§ä¼˜åŒ– | 2-3h |
| 3.9 æ–‡æ¡£ | 2-3h |
| **æ€»è®¡** | **31-41h** |

**å»ºè®®å¼€å‘å‘¨æœŸ**: æŒ‰æ¯å¤© 2-3 å°æ—¶å¼€å‘ï¼Œé¢„è®¡ **3-4 å‘¨** å®Œæˆ

---

## å…³é”®ä¾èµ–

```toml
[project.dependencies]
"scikit-learn>=1.3.0",      # æœºå™¨å­¦ä¹ åŸºç¡€
"scipy>=1.11.0",            # ç§‘å­¦è®¡ç®—
"lightfm>=1.16",            # æ¨èç®—æ³•ï¼ˆå¯é€‰ï¼‰
"sentence-transformers>=2.2.0", # å¥å­å‘é‡åŒ–ï¼ˆå¯é€‰ï¼‰
"numpy>=1.24.0",            # æ•°å€¼è®¡ç®—
"pandas>=2.0.0",            # æ•°æ®åˆ†æ
"redis>=5.0.0",             # ç¼“å­˜ï¼ˆå¯é€‰ï¼‰
```

---

## æ¨èç®—æ³•è¯¦è§£

### åŸºäºå†…å®¹çš„æ¨è (CBR)

```python
# 1. è®¡ç®—ç”¨æˆ·å…´è¶£å‘é‡
user_interest_vector = average(entry_vectors for entry in user_liked_entries)

# 2. è®¡ç®—å€™é€‰æ¡ç›®ç›¸ä¼¼åº¦
similarity = cosine_similarity(user_interest_vector, candidate_entry_vector)

# 3. æ’åºæ¨è
recommendations = sort_by_similarity(similarity)
```

### ååŒè¿‡æ»¤ (CF)

```python
# 1. æ„å»ºç”¨æˆ·-æ¡ç›®çŸ©é˜µ
user_item_matrix = build_matrix(interactions)

# 2. è®¡ç®—ç”¨æˆ·ç›¸ä¼¼åº¦
user_similarity = cosine_similarity(user_vector, other_users)

# 3. é¢„æµ‹ç”¨æˆ·å¯¹æœªè§è¿‡æ¡ç›®çš„è¯„åˆ†
predicted_score = weighted_average(similar_users_ratings)

# 4. æ¨èé«˜é¢„æµ‹åˆ†æ¡ç›®
```

### æ··åˆæ¨è

```python
# åŠ æƒèåˆ
final_score = 0.6 * cb_score + 0.3 * cf_score + 0.1 * popularity_score

# æˆ–åˆ‡æ¢ç­–ç•¥
if user.has_enough_history():
    use_collaborative_filtering()
else:
    use_content_based()
```

---

## ç›®å½•ç»“æ„æ‰©å±•

```
spider-aggregation/
â”œâ”€â”€ src/spider_aggregation/
â”‚   â”œâ”€â”€ analytics/              # ğŸ†• è¡Œä¸ºåˆ†æ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ tracker.py          # è¡Œä¸ºè¿½è¸ª
â”‚   â”‚   â”œâ”€â”€ aggregator.py       # æ•°æ®èšåˆ
â”‚   â”‚   â””â”€â”€ profiler.py         # ç”¨æˆ·ç”»åƒæ„å»º
â”‚   â”‚
â”‚   â”œâ”€â”€ features/               # ğŸ†• ç‰¹å¾å·¥ç¨‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ text_vectorizer.py  # æ–‡æœ¬å‘é‡åŒ–
â”‚   â”‚   â”œâ”€â”€ user_features.py    # ç”¨æˆ·ç‰¹å¾
â”‚   â”‚   â””â”€â”€ entry_features.py   # æ¡ç›®ç‰¹å¾
â”‚   â”‚
â”‚   â”œâ”€â”€ recommendation/         # ğŸ†• æ¨èç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py            # æ¨èå™¨åŸºç±»
â”‚   â”‚   â”œâ”€â”€ content_based.py   # åŸºäºå†…å®¹
â”‚   â”‚   â”œâ”€â”€ collaborative.py   # ååŒè¿‡æ»¤
â”‚   â”‚   â”œâ”€â”€ hybrid.py          # æ··åˆæ¨è
â”‚   â”‚   â””â”€â”€ diversity.py       # å¤šæ ·æ€§æ§åˆ¶
â”‚   â”‚
â”‚   â””â”€â”€ evaluation/             # ğŸ†• è¯„ä¼°æ¨¡å—
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ metrics.py         # è¯„ä¼°æŒ‡æ ‡
â”‚       â”œâ”€â”€ offline_eval.py    # ç¦»çº¿è¯„ä¼°
â”‚       â””â”€â”€ ab_test.py         # A/B æµ‹è¯•
â”‚
â”œâ”€â”€ models/                     # ğŸ†• è®­ç»ƒå¥½çš„æ¨¡å‹
â”‚   â”œâ”€â”€ tfidf_model.pkl
â”‚   â”œâ”€â”€ user_embeddings.npy
â”‚   â””â”€â”€ item_embeddings.npy
â”‚
â””â”€â”€ notebooks/                  # ğŸ†• åˆ†æç¬”è®°æœ¬
    â”œâ”€â”€ exploratory_analysis.ipynb
    â””â”€â”€ recommendation_evaluation.ipynb
```

---

## å†·å¯åŠ¨ç­–ç•¥

### æ–°ç”¨æˆ·
1. å¼•å¯¼ç”¨æˆ·é€‰æ‹©æ„Ÿå…´è¶£é¢†åŸŸ
2. ä½¿ç”¨çƒ­é—¨å†…å®¹æ¨è
3. åŸºäºè®¢é˜…æºçš„é»˜è®¤å…´è¶£

### æ–°å†…å®¹
1. åŸºäºå†…å®¹ç‰¹å¾åŒ¹é…ç”¨æˆ·å…´è¶£
2. æä¾›ç»™æ´»è·ƒç”¨æˆ·è¿›è¡Œæ¢ç´¢
3. é€æ­¥æ”¶é›†åé¦ˆè°ƒæ•´

---

## æ¨èè´¨é‡æŒ‡æ ‡

| æŒ‡æ ‡ | è¯´æ˜ | ç›®æ ‡å€¼ |
|------|------|--------|
| Precision@K | å‰Kä¸ªæ¨èçš„ç›¸å…³åº¦ | â‰¥ 0.6 |
| Recall@K | ç›¸å…³é¡¹è¢«å¬å›çš„æ¯”ä¾‹ | â‰¥ 0.5 |
| NDCG | æ’åºè´¨é‡ | â‰¥ 0.7 |
| Diversity | æ¨èå¤šæ ·æ€§ | â‰¥ 0.4 |
| Coverage | æ¡ç›®æ¨èè¦†ç›–ç‡ | â‰¥ 0.8 |
| CTR | ç‚¹å‡»ç‡ | â‰¥ 0.1 |

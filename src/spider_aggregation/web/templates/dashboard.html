{% extends "base.html" %}

{% block title %}仪表盘 - MindWeaver{% endblock %}

{% block content %}
<div class="page-header">
    <h2>仪表盘</h2>
</div>

<!-- Scheduler Control -->
<div class="dashboard-section">
    <h3>调度器控制</h3>
    <div class="scheduler-control">
        <div class="scheduler-status" id="scheduler-status">
            <span class="status-indicator" id="scheduler-indicator"></span>
            <span id="scheduler-status-text">加载中...</span>
        </div>
        <div class="scheduler-actions">
            <button type="button" class="btn btn-success" id="btn-start-scheduler" onclick="startScheduler()">启动调度器</button>
            <button type="button" class="btn btn-danger" id="btn-stop-scheduler" onclick="stopScheduler()" style="display: none;">停止调度器</button>
            <button type="button" class="btn btn-primary" id="btn-fetch-all" onclick="fetchAllFeeds()">立即抓取全部</button>
        </div>
    </div>
</div>

<!-- Stats Cards -->
<div class="dashboard-cards" id="stats-cards">
    <div class="dashboard-card">
        <div class="dashboard-card-title">总文章数</div>
        <div class="dashboard-card-value" id="total-entries">-</div>
    </div>
    <div class="dashboard-card">
        <div class="dashboard-card-title">订阅源数</div>
        <div class="dashboard-card-value" id="total-feeds">-</div>
    </div>
    <div class="dashboard-card">
        <div class="dashboard-card-title">过滤规则</div>
        <div class="dashboard-card-value" id="total-rules">-</div>
    </div>
    <div class="dashboard-card">
        <div class="dashboard-card-title">最后更新</div>
        <div class="dashboard-card-value" style="font-size: 1rem;" id="last-updated">-</div>
    </div>
</div>

<!-- Language Distribution Chart -->
<div class="dashboard-section">
    <h3>语言分布</h3>
    <div class="chart-container">
        <canvas id="language-chart"></canvas>
    </div>
</div>

<!-- Recent Activity -->
<div class="dashboard-section">
    <h3>最近活动</h3>
    <div id="recent-activity">
        <p class="empty-state">加载中...</p>
    </div>
</div>

<!-- Feed Health -->
<div class="dashboard-section">
    <h3>订阅源健康状态</h3>
    <div class="table-container">
        <table id="feed-health-table">
            <thead>
                <tr>
                    <th>订阅源</th>
                    <th>状态</th>
                    <th>最后抓取</th>
                    <th>错误数</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="4" class="empty-state">加载中...</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Quick Actions -->
<div class="dashboard-section">
    <h3>快捷操作</h3>
    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
        <a href="{{ url_for('feeds') }}" class="btn btn-primary">管理订阅源</a>
        <a href="{{ url_for('filter_rules') }}" class="btn btn-secondary">管理规则</a>
        <a href="{{ url_for('settings') }}" class="btn btn-secondary">设置</a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
